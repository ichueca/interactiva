<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resumen Final</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="main-container">
        
        <div class="content-card resumen-container">
            <h1 class="resumen-titulo">üéâ ¬°Felicidades!</h1>
            
            <div id="equipo-nombre" class="equipo-info">
            </div>

            <h2 style="font-size: 28px; color: #333; margin: 30px 0; text-align: center;">Has completado el curso de Java Streams</h2>

            <div class="resumen-puntos-badges">
                <div class="resumen-puntos-card">
                    <div class="puntos-icono">üèÜ</div>
                    <div class="puntos-valor" id="resumen-puntos-totales">0</div>
                    <div class="puntos-label">Puntos Totales</div>
                </div>
                <div class="resumen-badges-card">
                    <div class="badges-icono">üéñÔ∏è</div>
                    <div class="badges-valor" id="resumen-badges-totales">0</div>
                    <div class="badges-label">Badges Conseguidos</div>
                </div>
            </div>

            <div class="badges-obtenidos" id="badges-obtenidos">
            </div>

            <div class="resumen-tiempo" id="tiempo-total">
            </div>

            <div class="resumen-estadisticas">
                <h3>üìä Estad√≠sticas por Fase</h3>
                
                <div class="fases-estadisticas">
                    <div class="fase-stat">
                        <h4>Fase 1: Fundamentos</h4>
                        <div id="stats-fase1"></div>
                    </div>
                    <div class="fase-stat">
                        <h4>Fase 2: Operaciones Intermedias</h4>
                        <div id="stats-fase2"></div>
                    </div>
                    <div class="fase-stat">
                        <h4>Fase 3: Operaciones Terminales</h4>
                        <div id="stats-fase3"></div>
                    </div>
                </div>
            </div>

            <div class="resumen-conceptos">
                <h3>üí° Conceptos Aprendidos</h3>
                <div class="conceptos-grid">
                    <div class="concepto-card">
                        <h4>üåä Fundamentos de Streams</h4>
                        <ul>
                            <li>Qu√© son los Streams</li>
                            <li>Creaci√≥n de Streams</li>
                            <li>Operaciones Intermedias vs Terminales</li>
                        </ul>
                    </div>
                    <div class="concepto-card">
                        <h4>üîÑ Operaciones Intermedias</h4>
                        <ul>
                            <li>filter() - Filtrar elementos</li>
                            <li>map() - Transformar elementos</li>
                            <li>distinct() - Eliminar duplicados</li>
                            <li>sorted() - Ordenar</li>
                            <li>limit() / skip() - Limitar elementos</li>
                        </ul>
                    </div>
                    <div class="concepto-card">
                        <h4>üéØ Operaciones Terminales</h4>
                        <ul>
                            <li>collect() - Recolectar en colecciones</li>
                            <li>count() - Contar elementos</li>
                            <li>anyMatch() / allMatch() - Verificar</li>
                            <li>findFirst() / findAny() - Buscar</li>
                            <li>min() / max() - Extremos</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="contenido-avanzado-box" id="contenido-avanzado-box">
                <h3>üöÄ ¬øQuieres m√°s desaf√≠os?</h3>
                <p>Has completado el curso b√°sico. ¬°Ahora puedes explorar contenido avanzado opcional!</p>
                <div style="margin-top: 20px;">
                    <button class="btn-avanzado" onclick="irContenidoAvanzado()">
                        üìö Acceder a Contenido Avanzado
                    </button>
                </div>
                <div style="margin-top: 15px; font-size: 14px; color: #666;">
                    <strong>Incluye:</strong> reduce(), groupingBy(), partitioningBy(), Streams paralelos y m√°s
                </div>
            </div>

            <div style="margin-top: 40px; text-align: center;">
                <button class="btn-primary" onclick="volverInicio()">üè† Volver al inicio</button>
                <button class="btn-secondary" onclick="reiniciarProgreso()">‚Üª Reiniciar todo</button>
            </div>

            <div class="mensaje-final">
                <p>
                    ¬°Excelente trabajo! Has dominado los fundamentos de Java Streams.
                    Ahora est√°s listo para aplicar estos conocimientos en proyectos reales.
                </p>
            </div>
        </div>
    </div>

    <script src="js/common.js"></script>
    <script>
        if (!verificarEquipo()) {
            window.location.href = 'index.html';
        }

        crearHeader();

        // Detener el cron√≥metro en la p√°gina de resumen
        detenerCronometro();

        const progreso = getProgreso();

        const equipoNombre = document.getElementById('equipo-nombre');
        const equipoClass = `equipo-${progreso.equipo}`;
        const equipoEmoji = {
            'A': 'üî¥',
            'B': 'üîµ',
            'C': 'üü¢',
            'D': 'üü°'
        }[progreso.equipo] || '';
        equipoNombre.className = `equipo-info ${equipoClass}`;
        equipoNombre.textContent = `${equipoEmoji} Equipo ${progreso.equipo}`;

        const puntosTotales = getPuntosTotales();
        document.getElementById('resumen-puntos-totales').textContent = puntosTotales;

        const badges = progreso.badges || [];
        document.getElementById('resumen-badges-totales').textContent = badges.length;

        if (badges.length > 0) {
            const badgesDiv = document.getElementById('badges-obtenidos');
            badgesDiv.innerHTML = '<h3>üéñÔ∏è Tus Badges</h3><div class="badges-grid">';
            
            badges.forEach(badgeId => {
                const badge = BADGES[badgeId];
                if (badge) {
                    badgesDiv.innerHTML += `
                        <div class="badge-resumen">
                            <div class="badge-emoji">${badge.emoji}</div>
                            <div class="badge-nombre">${badge.nombre}</div>
                            <div class="badge-desc">${badge.descripcion}</div>
                        </div>
                    `;
                }
            });
            
            badgesDiv.innerHTML += '</div>';
        }

        const tiempoTotal = Date.now() - progreso.startTime;
        document.getElementById('tiempo-total').innerHTML = `
            <div class="tiempo-card">
                <div class="tiempo-icono">‚è±Ô∏è</div>
                <div class="tiempo-valor">${formatearTiempo(tiempoTotal)}</div>
                <div class="tiempo-label">Tiempo Total</div>
            </div>
        `;

        const fases = {
            'fase1': ['actividad1-1', 'actividad1-2', 'actividad1-3', 'actividad1-4'],
            'fase2': ['actividad2-1', 'actividad2-2', 'actividad2-3', 'actividad2-4', 'actividad2-5', 'actividad2-6', 'actividad2-7'],
            'fase3': ['actividad3-1', 'actividad3-2', 'actividad3-3', 'actividad3-4', 'actividad3-5', 'actividad3-6']
        };

        Object.keys(fases).forEach(faseId => {
            const actividades = fases[faseId];
            let totalIntentos = 0;
            let actividadesCompletadas = 0;
            let actividadesPerfectas = 0;
            let totalPuntos = 0;

            actividades.forEach(actId => {
                // Buscar la actividad completada
                const actCompletada = progreso.actividadesCompletadas.find(a => a.id === actId);

                if (actCompletada) {
                    actividadesCompletadas++;
                    totalIntentos += actCompletada.intentos;
                    totalPuntos += actCompletada.puntos || 0;
                    if (actCompletada.intentos === 1) actividadesPerfectas++;
                }
            });

            const statsDiv = document.getElementById(`stats-${faseId}`);
            statsDiv.innerHTML = `
                <div class="stat-item">
                    <span class="stat-label">Actividades completadas:</span>
                    <span class="stat-valor">${actividadesCompletadas}/${actividades.length}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Intentos totales:</span>
                    <span class="stat-valor">${totalIntentos}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Perfectas (1 intento):</span>
                    <span class="stat-valor">${actividadesPerfectas}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Puntos obtenidos:</span>
                    <span class="stat-valor">${totalPuntos}</span>
                </div>
            `;
        });

        function volverInicio() {
            window.location.href = 'index.html';
        }

        function reiniciarProgreso() {
            if (confirm('¬øEst√°s seguro de que quieres reiniciar todo el progreso? Esta acci√≥n no se puede deshacer.')) {
                localStorage.removeItem('streamProgress');
                window.location.href = 'index.html';
            }
        }

        function irContenidoAvanzado() {
            window.location.href = 'teoria4-1.html';
        }
    </script>
</body>
</html>
